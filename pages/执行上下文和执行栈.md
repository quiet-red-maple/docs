### 执行上下文

执行上下文是当前 javascript 代码被解析和执行时所在的环境的抽象概念。

### 执行上下文的类型

- 全局执行上下文：只有一个，浏览器中的全局对象就是 window 对象，this指向这个全局对象。
- 函数执行上下文：存在无数个，只有在函数调用的时候才会被创建，每次调用函数都会创建一个新的执行上下文。
- Eval函数执行上下文：指的是运行在eval函数中的代码，很少用且不建议使用。

### 执行栈

执行栈也叫调用栈，用于存储在代码执行期间创建的所有执行上下文。

首次运行js代码时，会创建一个全局执行上下文，并且push到当前执行栈中。

每当发生函数调用时，引擎都会为该函数创建一个新的函数执行上下文并push到当前执行栈的栈顶。

当栈顶函数运行完成后，其对应的函数执行上下文将会从执行栈中pop出，上下文控制权将移到当前执行栈的下一个执行上下文。

### 执行上下文的生命周期

执行上下文的生命周期包括三个阶段：创建阶段 → 执行阶段 → 回收阶段

#### 创建阶段

- 创建变量对象

  首先初始化函数的参数 arguments，提升函数声明和变量声明（变量的**声明提前**有赖于`var`关键字）。

- 创建作用域链

  在执行期上下文的创建阶段，作用域链是在变量对象之后创建的。作用域链本身包含变量对象。作用域链用于解析变量。当被要求解析变量时，JavaScript 始终从代码嵌套的最内层开始，如果最内层没有找到变量，就会跳转到上一层父作用域中查找，直到找到该变量。

- 确定this指向

#### 执行阶段

创建完成之后，就会开始执行代码，在这个阶段，会完成变量赋值、函数引用、以及执行其他代码。

#### 回收阶段

函数调用完毕后，函数出栈，对应的执行上下文也出栈，等待垃圾回收器回收执行上下文。

